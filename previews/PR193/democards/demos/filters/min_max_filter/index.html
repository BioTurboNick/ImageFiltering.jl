<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Max min filters · ImageFiltering</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link href="../../../gridtheme.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">ImageFiltering</span></div><form class="docs-search" action="../../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../../">ImageFiltering.jl</a></li><li><a class="tocitem" href="../../">Examples</a></li><li><a class="tocitem" href="../../../../function_reference/">Function reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Max min filters</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Max min filters</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaImages/ImageFiltering.jl/blob/master/docs/demos/filters/min_max_filter.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Max-min-filters-1"><a class="docs-heading-anchor" href="#Max-min-filters-1">Max min filters</a><a class="docs-heading-anchor-permalink" href="#Max-min-filters-1" title="Permalink"></a></h1><p><a href="../min_max_filter.jl"><img src="https://img.shields.io/badge/download-julia-brightgreen.svg" alt="Source code"/></a> <a href="https://nbviewer.jupyter.org/github/JuliaImages/ImageFiltering.jl/blob/gh-pages/previews/PR193/democards/demos/filters/min_max_filter.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt="notebook"/></a> <img src="https://img.shields.io/badge/Author-Deeptendu%20Santra-blue" alt="Author"/> <img src="https://img.shields.io/date/1602115200" alt="Update time"/></p><p>In this tutorial we see how can we can effectively use max and min filter to distinguish between smooth and texture edges in grayscale images. The example in this demo comes from [1].</p><p>We will use the <a href="../../../../function_reference/#ImageFiltering.MapWindow.mapwindow"><code>mapwindow</code></a> function in <code>ImageFiltering.jl</code> which provides a general functionality to apply any function to the window around each pixel. <a href="../median_filter/#median_filter_example-1">Custom median filters</a> is another usage example of <code>mapwindow</code>.</p><pre><code class="language-">using ImageCore, ImageShow, ImageFiltering
using MappedArrays
using TestImages

img = Gray.(testimage(&quot;house&quot;)); # Original Image
nothing #hide</code></pre><p>We need four statistics for our demo, they are: the local minimum, maximum, min-max, max-min of the input image. We can use <code>mapwindow</code> to get them.</p><pre><code class="language-">window_size = (15, 15)
img_min = mapwindow(minimum, img, window_size)
img_max = mapwindow(maximum, img, window_size)
img_max_min = mapwindow(maximum, img_min, window_size)
img_min_max = mapwindow(minimum, img_max, window_size)
mosaicview(img_min, img_max, img_max_min, img_min_max; nrow=1)</code></pre><p>When <code>f</code> is one of <code>maximum</code>, <code>minimum</code> and <code>maximum</code>, <code>mapwindow(f, img, window_size)</code> will use a streaming version Lemire max-min filter[2] to do the filtering work. This is more efficient than a plain maximum implementation.</p><pre><code class="language-julia">using BenchmarkTools
f(x) = minimum(x) # do note that `f !== minimum`
@btime mapwindow(f, $img, window_size) # 47.508 ms (202831 allocations: 12.91 MiB)
@btime mapwindow(minimum, $img, window_size) # 13.216 ms (58 allocations: 1.75 MiB)</code></pre><p><code>mapwindow</code> with <code>maximum</code>/<code>minimum</code> actually only uses the partial results from <code>mapwindow</code> with <code>extrema</code>, so if we need both results, we could half the computation by directly calling <code>extrema</code> and doing a manual splitting. Also, we could use a <code>MappedArrays.mappedarray</code> view to reduce the allocation.</p><pre><code class="language-">img_extrema = mapwindow(extrema, img, window_size) # half the computation
img_min = mappedarray(first, img_extrema) # 0 allocation
img_max = mappedarray(last, img_extrema) # 0 allocation
nothing #hide</code></pre><p>Now that we are done with the basic filtered images, we proceed to the next part which is edge detection using these filters.</p><p>For edge detection, we need to define thresholds for our image. The threshold is an important tool to binarize a grayscale image. The threshold value for a given pixel practically decides if the pixel visible or not in the output image. However, appyling a global threshold might not consider the variation of colors/brightness within the image. Thus we consider an adaptive type theresholding method here using max/min results.</p><p>The max(min) and min(max) filter effectively follows the smooth edges of the image. Therefore, their average also follows the smooth parts of the image. If we use this image as a threshold for the original image, the smooth parts of the original image will get filtered out, leaving only the texture and/or noise behind. So we can use the average of <code>img_max_min</code> and <code>img_min_max</code> as the texture threshold.</p><p>The average of min and max filters also gives us the smooth edges, but it also includes the noise in the image. So using average of <code>img_min</code> and <code>img_max</code> as a threshold will yeild only texture.</p><pre><code class="language-">img_texture_noise_threshold = (img_max_min + img_max_min) ./ 2
img_texture_threshold = (img_max + img_min) ./ 2
mosaicview(img_texture_noise_threshold, img_texture_threshold; nrow=1)</code></pre><pre><code class="language-"># The Dynamic Gist is obtained by subtracting the img_texture_threshold from the original image.
# The filtered image gives us the texture of the image.
img_dynamic_gist = img - img_texture_threshold
# The Texture Gist is obtained by subtracting img_texture_noise_threshold from the original image.
# The filtered image gives us the texture along with the noise of the image.
img_texture_gist = img - img_texture_noise_threshold
mosaicview(img_dynamic_gist, img_texture_gist; nrow=1)</code></pre><pre><code class="language-"># We extract out the smooth/ramp parts of the image.
# The darker section of the image consist of the ramp edges. The brighter pixels are mostly noise.
ramp = img_dynamic_gist - img_texture_gist
# Filtered-out edges
edge = img_max - img_min
# Smoothed-out version of edge
edge_smoothed = img_min_max - img_max_min
mosaicview(img, ramp, edge, edge_smoothed; nrow=2)</code></pre><h1 id="References-1"><a class="docs-heading-anchor" href="#References-1">References</a><a class="docs-heading-anchor-permalink" href="#References-1" title="Permalink"></a></h1><p>[1] Verbeek, P. W., Vrooman, H. A., &amp; Van Vliet, L. J. (1988). <a href="https://core.ac.uk/download/pdf/194053536.pdf">Low-level image processing by max-min filters</a>. Signal Processing, 15(3), 249-258.</p><p>[2] Lemire, D. (2006). <a href="https://lemire.me/en/publication/arxiv0610046/">Streaming maximum-minimum filter using no more than three comparisons per element</a>. arXiv preprint cs/0610046.</p><hr/><p><em>This page was generated using <a href="https://github.com/johnnychen94/DemoCards.jl">DemoCards.jl</a> and <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 11 October 2020 15:31">Sunday 11 October 2020</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
